<!DOCTYPE html>
<html>
    <head>
        <meta charset="utf-8">
        <title>Babylon 5 Communicator</title>
        
        <link rel="stylesheet" type="text/css" href="main.css">
    </head>
    
    <body style="background-image:url(background.jpg);">

<!--		<button id="btn">Обновить данные!</button> -->
		
	<div id="main_div">
		<div id="buttons_div"> 
			<img src="hyperdrive.png" alt="" class="mybutton" id="hyperdrive" >
			<p class="btntxt">Гипер. привод</p>
			<img src="jet.png" alt="" class="mybutton" id="mainjet1" >
			<p class="btntxt">Двигатель 1</p>
			<img src="jet.png" alt="" class="mybutton" id="mainjet2" >
			<p class="btntxt">Двигатель 2</p>
			<img src="hypertransm.png" alt="" class="mybutton" id="hypertransm1">
			<p class="btntxt">Тахионный передатчик 1</p>
			<img src="hypertransm.png" alt="" class="mybutton" id="hypertransm2">
			<p class="btntxt">Тахионный передатчик 2</p>
		</div>

		<div id="objects_div"> 
		
		</div>	
		

				
		<script src="jquery.min.js"></script>
		
		<script src="object_example.js"></script> 
		<script src="draw_general_object.js"></script> 
		
		<script>
			resizeMainDivs();
			$(window).resize(resizeMainDivs);
			
			
			
//			$("#objects_div").text(JSON.stringify(tmp_obj));

			function draw_general_object(l_data,l_div)
			{
				var lx=$(l_div).width(),ly=$(l_div).height();
				
				var l_used_keys=[];
				var l_used_actions=[];
				
				if ("name" in l_data.object.attributes) 
				{
					$(l_div).append("<p class=\"general_object_name\">"+ l_data.object.attributes.name.value+"</p>"); 	
					l_used_keys.push("name");
				}
				
				
				//отрисовываем заданное в темплейте. Там должно быть перечислено все. 
				if("template" in l_data.object)
				{
					var i=0,j=0;
					var tmp=l_data.object.template.groups;
					for(i=0;i<tmp.length;i++)
					{
						var tmp_group=$("<div class=\"general_object_group\"></div>").text("");
						
						if("name" in tmp[i])
						{	
							$(tmp_group).append(tmp[i].name);
							$(tmp_group).append("<hr>");
						}
						
						if("attributes" in tmp[i])
						{
							for(j=0;j<tmp[i].attributes.length;j++)
							{
								var tmp_attr=tmp[i].attributes[j];
	
								if("name" in  l_data.object.attributes[tmp_attr] )
								{
									$(tmp_group).append("<p class=\"general_object_desc\"><b>"+l_data.object.attributes[tmp_attr].name+"</b> : " +l_data.object.attributes[tmp_attr].value +" </p>");
								}
								else
								{
									$(tmp_group).append("<p class=\"general_object_desc\">"+l_data.object.attributes[tmp_attr].value +" </p>");
								}
								
								l_used_keys.push(tmp_attr);
							}
						}	

						if("actions" in tmp[i])
						{
							for(j=0;j<tmp[i].actions.length;j++)
							{
								var tmp_attr=tmp[i].actions[j];
	
								if("name" in  l_data.object.actions[tmp_attr] )
								{
									var tmp_button=$("<button class=\"general_object_button\">"+l_data.object.actions[tmp_attr].name+"</button>");
									$(tmp_button).click(function(){alert("Pressed!");});
									$(tmp_group).append(tmp_button);
								}
								
								l_used_actions.push(tmp_attr);
							}
						}
						$(l_div).append(tmp_group);
					} 
				
				}		
				
				//рисуем атрибуты без темплейта. От таких надо избавляться.
				var tmp=l_data.object.attributes;
				
				$.each(tmp, function(l_key,l_value)
				{
					if( $.inArray(l_key,l_used_keys) <0 && l_value.hidden != true )
					{
						if("name" in  l_value)
						{
							$(l_div).append("<p class=\"general_object_desc\"><b>"+l_value.name+"</b> : " +l_value.value +" </p>");
						}
						else
						{
							$(l_div).append("<p class=\"general_object_desc\">" + l_value.value +" </p>");
						}

					}

				});
				
				//рисуем кнопки без темплейта. От таких надо избавляться.
				
				var tmp=l_data.object.actions;
				$.each(tmp, function(l_key,l_value)
				{
					if( $.inArray(l_key,l_used_actions) <0)
					{
						
						if("name" in  l_value)
						{
							var tmp_button=$("<button class=\"general_object_button\">"+l_value.name+"</button>");
							$(tmp_button).click(function(){alert("Pressed!");});
							$(l_div).append(tmp_button);
						
						}
					}

				});
							
			} 
		
				
				
				
		
			
			draw_general_object(tmp_obj.data,"#objects_div");

		
		</script>

		<script>
/*
		


		var sysMap;
		var ctx;
		
		var mx=5,my=5,ny=-1,nx=-1;

		$(document).ready(function(){
			
		sysMap=$("#sysmap").get(0);
		ctx = sysMap.getContext('2d');


		setCurSystem();
			
		function sendServerSpaceData()
		{
	
			$.ajaxSetup({contentType: "application/json"});
			$.post(
			LOGINSERV,
			  JSON.stringify({
				"method": "get",
				"object_id": 1,
				"table": "kopernik_sys",
				"id" : 734	
	
				}),
				function(data,status)
				{
	//						$("#pbody2").html("Data: " + data + "<br> Status: " + status + "<br> Parsed Data: " + JSON.parse(data));
				
					var tmpdata=JSON.parse(JSON.parse(data));
					
					if(tmpdata.meta.mark==warpmark)
					{
						var tmpsend=
						{ 
							"meta": { "mark" : warpmark+1},
							"data": {
								"cursystem":cursystem,
								"destsystem":destsystem,
								"curspace":curspace,
								"curstatus":curstatus
								}
						};
				
						$.ajaxSetup({contentType: "application/json"});
						$.post(
							LOGINSERV,
							JSON.stringify({
								"method": "document",
								"object_id": 1,
								"table": "kopernik_sys",
								"id" : 734,	
								"data" : JSON.stringify(tmpsend)
							}),
							function(data,status)
							{
								getServerSpaceData();
							});							
					}
					else 
					{
						warpmark=tmpdata.meta.mark;
						curspace=tmpdata.data.curspace;
						destsystem=tmpdata.data.destsystem;
						cursystem=tmpdata.data.cursystem;
						curstatus=tmpdata.data.curstatus;
						
						setCurSystem();	
	
					}
				});				
	
		}	
	
		function getServerSpaceData()
		{
			$.ajaxSetup({contentType: "application/json"});
			$.post(
			LOGINSERV,
			  JSON.stringify({
				"method": "get",
				"object_id": 1,
				"table": "kopernik_sys",
				"id" : 734	
				}),
				function(data,status)
				{
//						$("#pbody2").html("Data: " + data + "<br> Status: " + status + "<br> Parsed Data: " + JSON.parse(data));
				
					var tmpdata=JSON.parse(JSON.parse(data));
					
					if(tmpdata.meta.mark>warpmark || (tmpdata.meta.mark==0 && warpmark!=0 ) )
					{
						warpmark=tmpdata.meta.mark;
						curspace=tmpdata.data.curspace;
						destsystem=tmpdata.data.destsystem;
						cursystem=tmpdata.data.cursystem;
						curstatus=tmpdata.data.curstatus;
						
						setCurSystem();		
//						$("#space").text("Пространство: "+curspace+" Система: " +cursystem + " Назначение: " + destsystem + " Статус: "+curstatus+" Mark: " + warpmark );	
					}
					else 
					{
//							$("#pbody2").html("<div style=\"color:red;\"> No Change!</div>");	
					}
				});				
		}



		$("#ntdestsys").click(function()
		{
			$("#sysDropdown").show();
		});
		
		$("#syslist0").click(function()
		{
			destsystem=0;
			if(destsystem!=cursystem) {nx=-1;ny=-1;}
			$("#sysDropdown").hide();
			setCurSystem();
			
		});

		$("#syslist1").click(function()
		{
			destsystem=1;
			if(destsystem!=cursystem) {nx=-1;ny=-1;}
			$("#sysDropdown").hide();
			setCurSystem();
			
			
		});
		
		$("#sysmap").click(function(event){
			clickEvent(event);
					
		});

		var int1, int2;	
			
		$("#start").click(function(event){
			

			
			if(sysfuncs==1 && nx>=0 && ny>=0 )
			{
				if(curstatus==0)
				{
					var tmp=5;
					curstatus=1;
	
					sendServerSpaceData();
					
					int1=setInterval(function()
					{
						if(tmp!=0)
						{
							$("#starttxt").css("color","red");
							$("#starttxt").text("Прыжок через "+tmp+" cекунд! Прервать?");
							tmp--;
						}
						else 
						{
							curstatus=2;
							curspace=1;
							clearInterval(int1);
							
							sendServerSpaceData();
							fillNote();
							
							tmp=5;
							int2=setInterval(function()
							{
								if(tmp!=0)
								{
									$("#starttxt").css("color","red");
									$("#starttxt").text("Гиперпространство! Прибытие через "+tmp+" cекунд!");
									tmp--;
								}
								else
								{
									curstatus=3;
									curspace=0;
									clearInterval(int2);
									sendServerSpaceData();
									
									tmp=5;
									int1=setInterval(function()
									{
										if(tmp!=0)
										{
											$("#starttxt").css("color","red");
											$("#starttxt").text("Прибытие в систему! Готовность через "+tmp+" cекунд!");
											tmp--;
										}
										else
										{
											curstatus=0;
											curspace=0;
											cursystem=destsystem;
											mx=nx;my=ny;
											nx=-1;ny=-1;
											clearInterval(int1);
											sendServerSpaceData();
											setCurSystem();
											
											$("#starttxt").css("color","black");
											$("#starttxt").text("Старт!");
										}
										
									},1000);
								
									
									
								}
								
								
							},1000);
						}	
					},1000);
					
				}
				else
				if(curstatus==1)
				{
					curstatus=0;
					curspace=0;

					clearInterval(int1);
					sendServerSpaceData();
					setCurSystem();
					
					$("#starttxt").css("color","black");
					$("#starttxt").text("Старт!");
				
				}
			}
			
					
		});

		
		setInterval(function()
			{
				getServerData();
				getServerSpaceData();
			},5000);
	});
*/
		</script>

	</body>


</html>
